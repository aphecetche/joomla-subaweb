//------------------------------------------------------------------------------------
// TABS and ACCORDIONS
//------------------------------------------------------------------------------------
Element.implement({accordion:function(){function n(e){e.hasClass("tabs-selected")?$$(e.removeClass("tabs-selected").get("href")).removeClass("tabs-panel-selected"):$$(e.addClass("tabs-selected").get("href")).addClass("tabs-panel-selected")}var e=this;document.body.addClass("featured-accordion");var t=e.getElement("#featured-links");t.getElements("a").each(function(e){e.addClass("tabs");var t=new Element("div.tabs"),n=document.getElement(e.get("href"));t.adopt(e);t.inject(n,"before");n.addClass("tabs-panel")});t.destroy();e.getElements("div.tabs > a").each(function(e){e.addEvent("click",function(t){n(e);e.focus();t.preventDefault()})})},removeAccordion:function(){var e=this;document.getElement("body").removeClass("featured-accordion");var t=e.getElement("#featured-content"),n=new Element("ul#featured-links");n.inject(t,"before");t.getElements("a.tabs").each(function(e){var t=e.getParent();e.removeClass("tabs");var r=new Element("li");r.adopt(e.clone());n.adopt(r);e.removeEvents();t.destroy()});t.getElements("div.tabs-panel").each(function(e){e.removeClass("tabs-panel").set("style","");var n=e.getParent();e.inject(t);n.destroy()})},removeTabs:function(){var e=this;document.body.removeClass("featured-tabs");var t=e.getElement("#featured-links"),n=e.getElement("#featured-content");t.erase("role").removeClass("tabs-nav");t.getElements("li").each(function(e){e.removeClass("tabs-selected").erase("role").erase("id")});n.removeClass("tabs-body").getElements("div").each(function(e){e.removeClass("tabs-panel").removeClass("tabs-panel-selected").set("id",e.get("id").replace(/-enhanced$/,""));e.show()})},tabs:function(){function s(e){var r=t.getElement("li.tabs-selected");r&&r.removeClass("tabs-selected");e.addClass("tabs-selected");var s=n.getElement("div.tabs-panel-selected");s&&s.set("aria-hidden",!0).removeClass("tabs-panel-selected");document.getElement(e.getElement("a").get("href")+i).addClass("tabs-panel-selected")}var e=this;document.body.addClass("featured-tabs");var t=e.getElement("#featured-links"),n=e.getElement("#featured-content"),r="tab-",i="-enhanced";t.addClass("tabs-nav").set("role","tablist");n.addClass("tabs-body");n.getElements(">div").each(function(e){e.addClass("tabs-panel").set("id",e.get("id")+i)});t.getElements("li").each(function(e){e.set("id",r+e.getElement("a").get("href").split("#")[1])});t.getElements("li").each(function(e){e.addEvent("click",function(){s(e);e.focus();return!1})});s(t.getFirst());return this}});var subatech={betternav2:function(e){var t=new Element("div#visual-fat-menu"),n=new Element("div#menu-heading"),r=e.getElement("a").clone().set("id","menu-heading");n.adopt(r);var i=new Element("span.btn_cancel",{html:'<button type="submit">X</button>'});n.adopt(i);t.adopt(n);var s=e.getChildren("ul > li > a");if(s.length){var o=new Element("div",{"class":"navgroup",html:"<ul></ul>"}),u=o.getElement("ul");s.each(function(e){u.adopt(e.getParent().clone())});t.adopt(o)}var a=e.getElements("span.separator");a.each(function(e){var n=new Element("div.navgroup"),r=new Element("h4",{text:e.get("text")});n.adopt(r);var i=e.getSiblings();i.each(function(e){n.adopt(e.clone())});t.adopt(n)});return t},addExpandedNavigation:function(){var e=document.id("nav-primary-fat-menu");if(e)return!1;e=new Element("div",{id:"nav-primary-fat-menu"});e.inject(document.id("nav-primary"),"after");var t=document.id("nav-primary").getElements("ul:first-child > li > a");t.each(function(e){var t=document.id("nav-primary-fat-menu"),n=(new Fx.Slide(t,{duration:400,transition:Fx.Transitions.Quad.easeOut,resetHeight:!0})).hide();e.addEvent("click",function(r){var i=e.getParent(),s=i.getElement("ul");if(!s)return;r.preventDefault();var o=i.getParent().getElement("li.open");if(o){o.removeClass("open");if(o.getElement("a").get("text")===this.get("text")){n.cancel();n.slideOut();return}}var u=!1;t.hasChildNodes()||(u=!0);t.empty();t.adopt(subatech.betternav2(i));t.getElement("button").addEvent("click",function(){n.cancel();n.slideOut();document.id("nav-primary").getElement("li[class~=open]").removeClass("open")});n.cancel();n.slideIn();i.addClass("open")})})},removeExpandedNavigation:function(){var e=document.id("nav-primary-fat-menu");if(!e)return;e.getParent().destroy();var t=document.id("nav-primary").getElements("ul:first-child > li");t.removeClass("open");t.getElements("a").each(function(e){e.removeEvents()})},addCompactNavigation:function(){var e=document.id("nav-primary"),t=e.getElement(".btn-navbar"),n=document.id(document.body);if(n.hasClass("compactnav"))return;t=new Element("a",{"class":"btn-navbar"});for(var r=0;r<3;++r){t.adopt(new Element("span",{"class":"icon-bar"}));e.adopt(t)}t.addEvent("click",function(){this.getParent().toggleClass("expanded")});document.body.addClass("compactnav").removeClass("regularnav")},removeCompactNavigation:function(){var e=document.id(document.body);if(e.hasClass("compactnav")){e.removeClass("compactnav").addClass("regularnav");e.getElement("#nav-primary").getElement(".btn-navbar").destroy()}},removeBannerImage:function(){var e=document.id("bannerimage"),t=e.get("img");t&&e.set("title",t.get("src")).empty().removeClass("expanded")},addBannerImage:function(){var e=document.id("bannerimage"),t=e.get("title");if(t){var n=new Element("img",{src:t,width:"100%"});e.set("title","");e.toggleClass("expanded");e.adopt(n)}},checkTabs:function(e){var t=document.id("featured");if(!t)return;var n=document.body;if(e>959){n.hasClass("featured-accordion")&&t.removeAccordion();n.hasClass("featured-tabs")||t.tabs()}else{n.hasClass("featured-tabs")&&t.removeTabs();n.hasClass("featured-accordion")||t.accordion()}},checkWidth:function(){var e=window.getCoordinates().width;if(e<560){this.removeBannerImage();this.removeExpandedNavigation();this.addCompactNavigation()}else{this.removeCompactNavigation();this.addExpandedNavigation();this.addBannerImage()}this.checkTabs(e)},sideShow:function(){var e=document.getElement("div.category-list.sideshow"),t,n;if(!e)return;var r=e.getElement("ul");t=new Element("div.sideshow-content");n=new Element("section");t.adopt(n);t.inject(document.body,"bottom");t.hide();var i=document.id("bannerimage"),s=function(){if(!i)return;var e=i.getCoordinates().bottom-window.getScroll().y+24;e>0?t.set("styles",{top:e}):t.set("styles",{top:0})};r.getChildren("li a").each(function(e){var r=e.getParent();r.addClass("project");var i=new Element("div.project-title"),o=new Element("div.project-link"),u=e.get("text").trim(),a=e.get("href"),f=a+"?tmpl=component";o.adopt(new Element("a",{href:a,text:""}));var l=new Element("h2");l.adopt(new Element("a",{href:a,text:u}));i.adopt(l);r.adopt(i);r.adopt(o);e.destroy();var c,h=new Request.HTML({url:f,method:"get",link:"cancel",async:!1,onRequest:function(){c=new Spinner(t,{message:"merci de patienter..."})},onComplete:function(){c&&c.destroy()},onSuccess:function(e,t){t.each(function(e){e.hasClass("sideshow")&&n.set("html",e.get("html"))})}}),p=o.getElement("a"),d=function(e){e.preventDefault();t.hide();window.removeEvent("scroll",s)},v=function(e){window.addEvent("scroll",s);s();n.empty();t.show();h.send();e.preventDefault()};p.addEvent("click",function(e){e.preventDefault()});p.addEvent("mouseenter",v);p.addEvent("mouseleave",d)})}};window.addEvent("domready",function(){subatech.checkWidth();subatech.sideShow()});window.addEventListener?window.addEventListener("resize",function(){subatech.checkWidth()},!1):window.attachEvent("onresize",function(){subatech.checkWidth()},!1);